# ═══════════════════════════════════════════════════════════════════════════
# 优服佳 环境变量模板 (Charter v2 — 加拿大合规版)
# 复制此文件为 .env 并填入真实值
# ⚠️  绝对不要将 .env 提交到 git！已在 .gitignore 中排除。
# ═══════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────
# 1. 数据库 (CPPA 数据主权: 必须使用加拿大地区)
# ───────────────────────────────────────────────────────────────────────────

# 本地开发: Docker PostgreSQL
DATABASE_URL="postgresql://youfujia_user:youfujia_password@localhost:5432/youfujia"

# 生产: Supabase Canada Region (ca-central-1)
# 获取: https://supabase.com → Project Settings → Database → Connection string
# DATABASE_URL="postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres"

# Supabase 直连 URL (用于 Prisma Migrate，非连接池)
# DIRECT_URL="postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT-REF].supabase.co:5432/postgres"

# ───────────────────────────────────────────────────────────────────────────
# 2. NextAuth.js (v4.24)
# ───────────────────────────────────────────────────────────────────────────
NEXTAUTH_SECRET="[生成: openssl rand -base64 32]"
NEXTAUTH_URL="http://localhost:3000"
# 生产: NEXTAUTH_URL="https://youfujia.ca"

# ───────────────────────────────────────────────────────────────────────────
# 3. Stripe (加拿大账户, CAD 结算)
# 获取: https://dashboard.stripe.com/test/apikeys
# ───────────────────────────────────────────────────────────────────────────
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_PUBLISHABLE_KEY="pk_test_..."
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_test_..."

# Webhook Secret (本地测试: stripe listen --forward-to localhost:3000/api/webhooks/stripe)
STRIPE_WEBHOOK_SECRET="whsec_..."

# 平台手续费率 (e.g. 0.05 = 5%)
STRIPE_PLATFORM_FEE_RATE="0.05"

# ───────────────────────────────────────────────────────────────────────────
# 4. Upstash Redis (Canada Region — 语义缓存 + Cron 幂等锁)
# 获取: https://console.upstash.com → Create Database → Region: Canada (ca-central-1)
# ───────────────────────────────────────────────────────────────────────────
UPSTASH_REDIS_REST_URL="https://[YOUR-DB-ID].upstash.io"
UPSTASH_REDIS_REST_TOKEN="[YOUR-TOKEN]"

# ───────────────────────────────────────────────────────────────────────────
# 5. Supabase (文件存储 — PAD 协议 PDF + 合同文件)
# ⚠️  必须使用 Canada Region (ca-central-1)
# ───────────────────────────────────────────────────────────────────────────
NEXT_PUBLIC_SUPABASE_URL="https://[YOUR-PROJECT-REF].supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="eyJ..."
SUPABASE_SERVICE_ROLE_KEY="eyJ..."

# Supabase Storage Bucket 名称
SUPABASE_STORAGE_BUCKET_PAD="pad-agreements"
SUPABASE_STORAGE_BUCKET_CONTRACTS="contracts"
SUPABASE_STORAGE_BUCKET_AVATARS="avatars"

# ───────────────────────────────────────────────────────────────────────────
# 6. AI 服务 (成本分级: Tier 1 < $0.001, Tier 2 < $0.05)
# ───────────────────────────────────────────────────────────────────────────
# Tier 1 — 默认模型 (摘要 / 标签 / 情感)
OPENAI_API_KEY="sk-..."
OPENAI_DEFAULT_MODEL="gpt-4o-mini"

# Tier 2 — 审批后使用 (合同分析 / 风控)
ANTHROPIC_API_KEY="sk-ant-..."
ANTHROPIC_TIER2_MODEL="claude-3-5-sonnet-20241022"

# Tier 1B — 翻译 (中英互译)
GOOGLE_TRANSLATE_API_KEY="AIza..."

# AI 配额控制
AI_DAILY_TOKEN_LIMIT_PER_USER="50000"
AI_SEMANTIC_CACHE_TTL_SECONDS="3600"

# ───────────────────────────────────────────────────────────────────────────
# 7. SMS 通知 (Twilio)
# 获取: https://console.twilio.com
# ───────────────────────────────────────────────────────────────────────────
TWILIO_ACCOUNT_SID="AC..."
TWILIO_AUTH_TOKEN="..."
TWILIO_PHONE_NUMBER="+1..."

# ───────────────────────────────────────────────────────────────────────────
# 7b. Email (Resend — 验证码 / 通知邮件)
# 获取: https://resend.com → API Keys
# ───────────────────────────────────────────────────────────────────────────
RESEND_API_KEY="re_..."
RESEND_FROM_EMAIL="noreply@youfujia.ca"   # 需在 Resend 验证过的域名

# ───────────────────────────────────────────────────────────────────────────
# 8. Web Push (PWA — VAPID Keys)
# 生成: npx web-push generate-vapid-keys
# ───────────────────────────────────────────────────────────────────────────
NEXT_PUBLIC_VAPID_PUBLIC_KEY="BN..."
VAPID_PRIVATE_KEY="..."
VAPID_SUBJECT="mailto:admin@youfujia.ca"

# ───────────────────────────────────────────────────────────────────────────
# 9. Firebase (FCM — Mobile Push, 可选)
# ───────────────────────────────────────────────────────────────────────────
FIREBASE_PROJECT_ID="youfujia"
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL="firebase-adminsdk-xxxxx@youfujia.iam.gserviceaccount.com"

# ───────────────────────────────────────────────────────────────────────────
# 10. Google Maps / Places API (地址自动补全)
# 获取: https://console.cloud.google.com → APIs & Services → Credentials
# 需开启: Maps JavaScript API + Places API (New)
# 建议限制域名: youfujia.ca, localhost
# ───────────────────────────────────────────────────────────────────────────
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=""

# ───────────────────────────────────────────────────────────────────────────
# 11. Cron Job 认证
# ───────────────────────────────────────────────────────────────────────────
CRON_API_KEY="[生成: openssl rand -hex 32]"

# ───────────────────────────────────────────────────────────────────────────
# 12. SimpleWebAuthn (Passkeys / FIDO2)
# ───────────────────────────────────────────────────────────────────────────
WEBAUTHN_RP_NAME="优服佳"
WEBAUTHN_RP_ID="youfujia.ca"
WEBAUTHN_ORIGIN="https://youfujia.ca"
# 本地测试:
# WEBAUTHN_RP_ID="localhost"
# WEBAUTHN_ORIGIN="http://localhost:3000"

# ───────────────────────────────────────────────────────────────────────────
# 13. 应用配置
# ───────────────────────────────────────────────────────────────────────────
NEXT_PUBLIC_APP_NAME="优服佳"
NEXT_PUBLIC_APP_URL="https://youfujia.ca"
NEXT_PUBLIC_DEFAULT_CURRENCY="CAD"
NEXT_PUBLIC_DEFAULT_CITY="Guelph"
NEXT_PUBLIC_DEFAULT_PROVINCE="Ontario"
NEXT_PUBLIC_DEFAULT_COUNTRY="Canada"

# PAD 阈值 (加拿大 Payments Canada 标准, 单位 CAD)
PAD_THRESHOLD_CAD="1000"

# 日志级别
LOG_LEVEL="info"
NODE_ENV="development"

# ───────────────────────────────────────────────────────────────────────────
# 13. 本地测试快速配置 (仅用于开发，不可用于生产)
# 取消下面注释即可快速启动本地测试（无需真实密钥）
# ───────────────────────────────────────────────────────────────────────────
# STRIPE_SECRET_KEY="sk_test_placeholder_local_testing_only"
# STRIPE_PUBLISHABLE_KEY="pk_test_placeholder_local_testing_only"
# NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_test_placeholder_local_testing_only"
# STRIPE_WEBHOOK_SECRET="whsec_placeholder_local_testing_only"
# UPSTASH_REDIS_REST_URL="http://localhost:6379"
# UPSTASH_REDIS_REST_TOKEN="local_test_token"
# TWILIO_ACCOUNT_SID="AC_local_test"
# TWILIO_AUTH_TOKEN="local_test_auth"
# TWILIO_PHONE_NUMBER="+15555555555"
# WEBAUTHN_RP_ID="localhost"
# WEBAUTHN_ORIGIN="http://localhost:3000"
